rules:
  - id: fetch-no-raw-json-parse
    message: "과거 오류: fetch 응답 raw JSON parse 누락 (response.json() 사용)"
    severity: ERROR
    languages: [javascript, typescript]
    pattern: |
      fetch($URL).then($X)
    metavariable-regex:
      X: "(?!.*json\\(\\))"

  - id: console-log-in-production
    message: "과거 오류: console.log가 프로덕션 코드에 남아있음"
    severity: ERROR
    languages: [javascript, typescript]
    pattern: |
      console.log($X)
    paths:
      exclude:
        - "**/*.test.*"
        - "**/*.spec.*"
        - "**/__tests__/**"
        - "**/tests/**"

  - id: hardcoded-secrets
    message: "과거 오류: 하드코딩된 시크릿 값 발견"
    severity: ERROR
    languages: [javascript, typescript]
    patterns:
      - pattern-either:
          - pattern: "password\\s*=\\s*[\"'][^\"']{8,}[\"']"
          - pattern: "secret\\s*=\\s*[\"'][^\"']{8,}[\"']"
          - pattern: "key\\s*=\\s*[\"'][^\"']{8,}[\"']"
          - pattern: "token\\s*=\\s*[\"'][^\"']{8,}[\"']"
    paths:
      exclude:
        - "**/*.test.*"
        - "**/*.spec.*"
        - "**/__tests__/**"
        - "**/tests/**"

  - id: unhandled-promise-rejection
    message: "과거 오류: 처리되지 않은 Promise rejection"
    severity: ERROR
    languages: [javascript, typescript]
    pattern: |
      $FUNC($ARGS).then($HANDLER)
    metavariable-regex:
      HANDLER: "(?!.*catch)"

  - id: memory-leak-potential
    message: "과거 오류: 메모리 누수 가능성 - 이벤트 리스너 정리 누락"
    severity: WARN
    languages: [javascript, typescript]
    pattern: |
      addEventListener($EVENT, $HANDLER)
    paths:
      exclude:
        - "**/*.test.*"
        - "**/*.spec.*"
        - "**/__tests__/**"
        - "**/tests/**"

  - id: dangerous-eval-usage
    message: "과거 오류: eval() 사용으로 인한 보안 취약점"
    severity: ERROR
    languages: [javascript, typescript]
    pattern: |
      eval($X)

  - id: sql-injection-risk
    message: "과거 오류: SQL 인젝션 위험 - 문자열 연결로 쿼리 구성"
    severity: ERROR
    languages: [javascript, typescript]
    patterns:
      - pattern-either:
          - pattern: "db\\.query\\(.*\\+.*\\)"
          - pattern: "mongoose\\.find\\(.*\\+.*\\)"
          - pattern: "collection\\.find\\(.*\\+.*\\)"

  - id: missing-error-handling
    message: "과거 오류: 에러 핸들링 누락 - try-catch 없이 비동기 함수 호출"
    severity: WARN
    languages: [javascript, typescript]
    pattern: |
      await $FUNC($ARGS)
    paths:
      exclude:
        - "**/*.test.*"
        - "**/*.spec.*"
        - "**/__tests__/**"
        - "**/tests/**"

  - id: infinite-loop-risk
    message: "과거 오류: 무한 루프 위험 - while(true) 패턴"
    severity: ERROR
    languages: [javascript, typescript]
    pattern: |
      while(true)

  - id: deprecated-api-usage
    message: "과거 오류: deprecated API 사용"
    severity: WARN
    languages: [javascript, typescript]
    patterns:
      - pattern-either:
          - pattern: "componentWillMount"
          - pattern: "componentWillReceiveProps"
          - pattern: "componentWillUpdate"
          - pattern: "UNSAFE_"

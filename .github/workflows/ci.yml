name: CI Preflight

on:
  pull_request:
    branches: [ main, develop, master ]
  push:
    branches: [ main, develop, master ]

env:
  NODE_VERSION: '20'
  CACHE_VERSION: 'v1'

jobs:
  preflight:
    name: Preflight ê²€ì¦
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ“¦ Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: 'package-lock.json'

      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: |
          npm ci
          echo "âœ… ì˜ì¡´ì„± ì„¤ì¹˜ ì™„ë£Œ"

      - name: ğŸ” í™˜ê²½ë³€ìˆ˜ ìŠ¤í‚¤ë§ˆ ê²€ì¦
        run: npm run check:env
        continue-on-error: false

      - name: ğŸ” TypeScript íƒ€ì… ì²´í¬
        run: npm run check:types
        continue-on-error: false

      - name: ğŸ” ESLint ê²€ì‚¬
        run: npm run check:lint
        continue-on-error: false

      - name: ğŸ” Prettier í¬ë§· ê²€ì‚¬
        run: npm run check:format
        continue-on-error: false

      - name: ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        run: npm run check:test
        continue-on-error: false

      - name: â™¿ ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸
        run: npm run check:accessibility
        continue-on-error: false

      - name: ğŸ§¹ ë¯¸ì‚¬ìš© ì½”ë“œ ê²€ì‚¬
        run: npm run check:deadcode
        continue-on-error: false

      - name: ğŸ“¦ ì˜ì¡´ì„± ë° êµ¬ì„± ê²€ì‚¬
        run: npm run check:deps
        continue-on-error: false

      - name: ğŸ¨ ìƒ‰ìƒ í•˜ë“œì½”ë”© ê²€ì‚¬
        run: |
          # Windows í™˜ê²½ì´ ì•„ë‹ˆë¯€ë¡œ ìƒ‰ìƒ ê²€ì‚¬ ìŠ¤í‚µ
          echo "â„¹ï¸  ìƒ‰ìƒ ê²€ì‚¬ëŠ” Windows í™˜ê²½ì—ì„œë§Œ ì‹¤í–‰ë©ë‹ˆë‹¤"
        continue-on-error: true

      - name: ğŸ—ï¸ í”„ë¡œë•ì…˜ ë¹Œë“œ
        run: npm run check:build
        continue-on-error: false

      - name: ğŸ‰ ê²°ê³¼ ìš”ì•½
        if: always()
        run: |
          echo "ğŸ‰ Preflight ê²€ì¦ ì™„ë£Œ!"
          echo "âœ… ëª¨ë“  ê²€ì¦ì´ í†µê³¼í–ˆìŠµë‹ˆë‹¤"
          echo "ğŸš€ ë°°í¬ ì¤€ë¹„ ì™„ë£Œ"